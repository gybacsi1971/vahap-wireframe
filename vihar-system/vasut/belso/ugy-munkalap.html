<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAHAP - Vasúti Ügymunkalap</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- VAHAP Common CSS -->
    <link rel="stylesheet" href="../../assets/css/vihar-common.css">

    <style>
        body {
            overflow: hidden;
        }

        .workflow-nav-item {
            position: relative;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .workflow-nav-item:hover {
            background-color: rgba(139, 69, 19, 0.05);
            border-left-color: var(--vasut-color);
        }

        .workflow-nav-item.active {
            background-color: rgba(139, 69, 19, 0.1);
            border-left-color: var(--vasut-color);
            font-weight: 600;
        }

        .workflow-nav-item.completed {
            opacity: 0.7;
        }

        .workflow-nav-item.completed::after {
            content: '\f26b';
            font-family: 'bootstrap-icons';
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--vahap-success);
            font-size: 1.1rem;
        }

        .workflow-nav-item.in-progress {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { background-color: rgba(255, 193, 7, 0.05); }
            50% { background-color: rgba(255, 193, 7, 0.15); }
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .status-badge.kész {
            background-color: var(--vahap-success);
            color: white;
        }

        .status-badge.folyamatban {
            background-color: var(--vahap-warning);
            color: #000;
        }

        .status-badge.várakozik {
            background-color: var(--vahap-secondary);
            color: white;
        }

        .case-header {
            background: linear-gradient(135deg, var(--vasut-color) 0%, #6d3410 100%);
            color: white;
            padding: 1.25rem;
            border-bottom: 3px solid rgba(0,0,0,0.1);
        }

        .case-info-item {
            padding: 0 1rem;
        }

        .case-info-label {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .case-info-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .tab-pane {
            padding: 1.5rem;
            background-color: #fff;
        }

        .checklist-card {
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .checklist-item {
            padding: 0.75rem;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .checklist-item:hover {
            background-color: #f8f9fa;
        }

        .checklist-item.checked {
            background-color: #f0fdf4;
            border-left: 3px solid var(--vahap-success);
        }

        .decision-button {
            width: 100%;
            text-align: left;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            position: relative;
        }

        .decision-button:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .decision-button .badge {
            font-size: 0.65rem;
            margin-right: 0.5rem;
        }

        .timeline-item {
            position: relative;
            padding-left: 1.5rem;
            padding-bottom: 1rem;
            border-left: 2px solid var(--vasut-color);
        }

        .timeline-item:last-child {
            border-left-color: transparent;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -0.4rem;
            top: 0;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: var(--vasut-color);
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--vasut-color);
        }

        .timeline-date {
            font-size: 0.75rem;
            color: var(--vahap-secondary);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .timeline-content {
            background-color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .document-item {
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .document-item:hover {
            background-color: #f8f9fa;
            border-color: var(--vasut-color);
            transform: translateX(3px);
        }

        .document-icon {
            font-size: 1.25rem;
            color: var(--vahap-danger);
            margin-right: 0.5rem;
        }

        .badge-uce {
            background-color: var(--vahap-info);
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }

        .badge-function {
            background-color: var(--vahap-secondary);
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }

        .tab-header {
            background-color: #f8f9fa;
            padding: 1rem;
            border-bottom: 2px solid var(--vasut-color);
            margin: -1.5rem -1.5rem 1.5rem;
        }

        .alert-statusz {
            border-left: 4px solid var(--vasut-color);
            background-color: rgba(139, 69, 19, 0.05);
        }

        .overflow-auto-content {
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        .nav-tabs .nav-link {
            color: var(--vahap-dark);
            border: none;
            border-bottom: 3px solid transparent;
            padding: 0.75rem 1rem;
        }

        .nav-tabs .nav-link:hover {
            border-color: rgba(139, 69, 19, 0.3);
        }

        .nav-tabs .nav-link.active {
            color: var(--vasut-color);
            background-color: transparent;
            border-color: var(--vasut-color);
            font-weight: 600;
        }

        /* Kollapsz funkció */
        .sidebar-left, .sidebar-right {
            transition: width 0.3s ease, flex 0.3s ease, max-width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sidebar-left.collapsed {
            max-width: 50px !important;
            min-width: 50px !important;
            flex: 0 0 50px !important;
            width: 50px !important;
            box-sizing: border-box !important;
            border-right: none !important;
        }

        .sidebar-right.collapsed {
            max-width: 50px !important;
            min-width: 50px !important;
            flex: 0 0 50px !important;
            width: 50px !important;
            box-sizing: border-box !important;
            border-left: none !important;
        }

        /* Collapsed állapotban border eltávolítása, hogy pontosan 50px legyen */
        .sidebar-right.collapsed {
            padding-left: 0 !important;
            border-left: none !important;
        }

        .sidebar-left.collapsed {
            padding-right: 0 !important;
            border-right: none !important;
        }

        /* Bootstrap col override amikor collapsed - magasabb specifitás */
        .row .col-md-3.sidebar-right.collapsed,
        div.col-md-3.sidebar-right.collapsed {
            flex: 0 0 50px !important;
            max-width: 50px !important;
            width: 50px !important;
        }

        .row .col-md-2.sidebar-left.collapsed,
        div.col-md-2.sidebar-left.collapsed {
            flex: 0 0 50px !important;
            max-width: 50px !important;
            width: 50px !important;
        }

        /* Debugging helper */
        [class*="sidebar"].collapsed {
            background-color: #f0f0f0 !important;
        }

        .sidebar-content {
            transition: opacity 0.2s ease;
        }

        .collapsed .sidebar-content {
            opacity: 0;
            visibility: hidden;
            position: absolute;
        }

        .collapsed-icon-bar {
            display: none;
            padding: 1rem 0;
            height: 100%;
            width: 100%;
        }

        .collapsed .collapsed-icon-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 50px;
            padding: 1rem 0;
            overflow: hidden;
            border: none !important;
        }

        /* Ikonok méret korlátozása collapsed állapotban */
        .collapsed-icon-bar i {
            font-size: 1.2rem !important;
        }

        .collapsed-icon-bar .badge {
            font-size: 0.7rem !important;
            padding: 0.2rem 0.4rem !important;
        }

        .sidebar-left .collapsed-icon-bar {
            justify-content: flex-start;
        }

        .sidebar-right .collapsed-icon-bar {
            justify-content: flex-start;
        }

        .toggle-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            background: var(--vasut-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }

        .toggle-btn:hover {
            background: #6d3410;
            transform: translateY(-50%) scale(1.1);
        }

        .toggle-btn-left {
            right: -15px;
        }

        .toggle-btn-right {
            left: -15px;
        }

        .middle-column {
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        /* Row flexbox fix */
        .vh-100.row {
            flex-wrap: nowrap !important;
            margin: 0 !important;
            width: 100vw !important;
            max-width: 100vw !important;
        }

        body {
            overflow-x: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .container-fluid {
            padding: 0 !important;
            margin: 0 !important;
            max-width: 100vw !important;
            overflow-x: hidden !important;
        }

        html {
            overflow-x: hidden !important;
        }

        .overflow-auto-sidebar {
            overflow-y: auto;
            overflow-x: auto;
            height: 100%;
        }

        /* Bal és jobb oldali sidebar scrollozható tartalom */
        .sidebar-left, .sidebar-right {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .sidebar-left .sidebar-content,
        .sidebar-right .sidebar-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: auto;
        }

        /* Középső oszlop független scrollozás */
        .middle-column {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .middle-column .case-header {
            flex-shrink: 0;
        }

        .middle-column .flex-grow-1.overflow-auto {
            flex: 1;
            overflow-y: auto;
            overflow-x: auto;
        }
    </style>

    <!-- DÁP Design System - Inter betűtípus -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div class="container-fluid">
            <div class="row vh-100">

                <!-- ========================================
                     1. BAL OSZLOP - Navigáció (2 col)
                     ======================================== -->
                <div class="col-md-2 bg-light p-0 d-flex flex-column sidebar-left"
                     :class="{
                         collapsed: leftCollapsed,
                         'border-end': !leftCollapsed
                     }"
                     :style="{
                         flex: leftCollapsed ? '0 0 50px' : '',
                         maxWidth: leftCollapsed ? '50px' : '',
                         width: leftCollapsed ? '50px' : ''
                     }">

                    <!-- Toggle gomb -->
                    <button class="toggle-btn toggle-btn-left" @click="leftCollapsed = !leftCollapsed">
                        <i class="bi" :class="leftCollapsed ? 'bi-chevron-right' : 'bi-chevron-left'"></i>
                    </button>

                    <!-- Normál nézet tartalma -->
                    <div class="sidebar-content">
                        <!-- Modul fejléc -->
                        <div class="p-3 border-bottom bg-white">
                            <h6 class="mb-0 text-vasut fw-bold">
                                <i class="bi bi-train-front"></i> VAHAP - Vasúti Modul
                            </h6>
                            <span class="badge bg-vasut mt-2">V-044</span>
                        </div>

                        <!-- Navigációs menü - Workflow lépések -->
                        <div class="flex-grow-1 overflow-auto-sidebar p-2">
                        <div class="nav flex-column">

                            <div class="workflow-nav-item completed"
                                 @click="selectTab('hatáskor')"
                                 :class="{ active: activeTab === 'hatáskor' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1793</span>
                                    <span class="status-badge kész">kész</span>
                                </div>
                                <div class="small">Hatáskör vizsgálat</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0064</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item in-progress"
                                 @click="selectTab('formai')"
                                 :class="{ active: activeTab === 'formai' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1799</span>
                                    <span class="status-badge folyamatban">folyamatban</span>
                                </div>
                                <div class="small">Formai megfelelőség</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0065</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('tartalmi')"
                                 :class="{ active: activeTab === 'tartalmi' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1794</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">Tartalmi megfelelőség</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0066</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('vny024')"
                                 :class="{ active: activeTab === 'vny024' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-function">F-0090</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">VNY024 Adatok</div>
                                <div class="mt-1">
                                    <small class="text-muted">Vasútegészségügy</small>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('sommas')"
                                 :class="{ active: activeTab === 'sommas' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1800</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">Sommás eljárás döntés</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0088</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('dontesi-javaslat')"
                                 :class="{ active: activeTab === 'dontesi-javaslat' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1826</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">Döntési javaslat</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0074</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('dokumentumok')"
                                 :class="{ active: activeTab === 'dokumentumok' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1809/10/11</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">Dokumentum tervezetek</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0091/92/93</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('velemenyezes')"
                                 :class="{ active: activeTab === 'velemenyezes' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1824</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">Véleményeztetés</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0096</span>
                                </div>
                            </div>

                            <div class="workflow-nav-item"
                                 @click="selectTab('lezaras')"
                                 :class="{ active: activeTab === 'lezaras' }">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span class="badge badge-uce">UCE-1828</span>
                                    <span class="status-badge várakozik">várakozik</span>
                                </div>
                                <div class="small">Ügy lezárása</div>
                                <div class="mt-1">
                                    <span class="badge badge-function">F-0097</span>
                                </div>
                            </div>

                        </div>
                        </div>

                        <!-- Vissza gomb -->
                        <div class="border-top p-3 bg-white">
                            <a href="munkalista.html" class="btn btn-outline-secondary btn-sm w-100">
                                <i class="bi bi-arrow-left"></i> Vissza a listára
                            </a>
                        </div>
                    </div>

                    <!-- Kollapsz ikon sáv -->
                    <div class="collapsed-icon-bar bg-light">
                        <div class="text-center mb-3">
                            <i class="bi bi-train-front" style="font-size: 1.5rem; color: var(--vasut-color);"></i>
                        </div>
                        <div class="text-center mb-2" v-if="ugy.workflow_lepesek && ugy.workflow_lepesek.erkeztetes">
                            <i class="bi bi-check-circle text-success" title="Érkeztetés"></i>
                        </div>
                        <div class="text-center mb-2" v-if="ugy.workflow_lepesek && ugy.workflow_lepesek.hatáskor_vizsgalat">
                            <i class="bi bi-shield-check" :class="ugy.workflow_lepesek.hatáskor_vizsgalat.allapot === 'kész' ? 'text-success' : 'text-warning'" title="Hatáskör"></i>
                        </div>
                        <div class="text-center mb-2" v-if="ugy.workflow_lepesek && ugy.workflow_lepesek.formai_vizsgalat">
                            <i class="bi bi-file-check" :class="ugy.workflow_lepesek.formai_vizsgalat.allapot === 'kész' ? 'text-success' : 'text-warning'" title="Formai"></i>
                        </div>
                        <div class="text-center mb-2" v-if="ugy.workflow_lepesek && ugy.workflow_lepesek.tartalmi_vizsgalat">
                            <i class="bi bi-clipboard-check" :class="ugy.workflow_lepesek.tartalmi_vizsgalat.allapot === 'kész' ? 'text-success' : 'text-warning'" title="Tartalmi"></i>
                        </div>
                    </div>

                </div>

                <!-- ========================================
                     2. KÖZÉPSŐ OSZLOP - Munkaterület (7 col)
                     ======================================== -->
                <div class="p-0 d-flex flex-column middle-column"
                     :class="{
                         'col-md-7': !leftCollapsed && !rightCollapsed,
                         'col-md-9': leftCollapsed && !rightCollapsed
                     }"
                     :style="{
                         flex: (leftCollapsed && rightCollapsed) || (!leftCollapsed && rightCollapsed) ? '1 1 auto' : ''
                     }">

                    <!-- Ügyfejléc -->
                    <div class="case-header">
                        <div class="row g-0">
                            <div class="col-4 case-info-item">
                                <div class="case-info-label">Ügyazonosító</div>
                                <div class="case-info-value">{{ ugy.ugyazonosito }}</div>
                            </div>
                            <div class="col-3 case-info-item">
                                <div class="case-info-label">Ügyfél</div>
                                <div class="case-info-value">{{ ugy.ugyfel && ugy.ugyfel.nev ? ugy.ugyfel.nev : 'N/A' }}</div>
                            </div>
                            <div class="col-3 case-info-item">
                                <div class="case-info-label">Határidő</div>
                                <div class="case-info-value">{{ formatDate(ugy.hatarido) }}</div>
                                <small v-if="ugy.hatralevo_napok" class="text-warning-emphasis">{{ ugy.hatralevo_napok }} nap</small>
                            </div>
                            <div class="col-2 case-info-item">
                                <div class="case-info-label">Eljárás</div>
                                <div class="case-info-value" style="font-size: 0.85rem;">{{ ugy.hatarido_tipus === 'teljes_eljaras' ? 'Teljes' : (ugy.hatarido_tipus === 'sommas' ? 'Sommás' : 'N/A') }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Munkaterület -->
                    <div class="flex-grow-1 overflow-auto p-3">

                        <!-- Tab: Hatáskör vizsgálat -->
                        <div v-show="activeTab === 'hatáskor'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1793</span>
                                    Hatáskör és illetékesség vizsgálata
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0064</span>
                                    Annak vizsgálata, hogy a kérelem elbírálása a hatóság hatáskörébe és illetékességébe tartozik-e
                                </p>
                            </div>

                            <div class="alert alert-statusz">
                                <strong>Státusz:</strong>
                                <span class="badge bg-success ms-2">Befejezve</span>
                                <div class="mt-2 small">
                                    <i class="bi bi-check-circle text-success"></i>
                                    Hatáskör biztosított - {{ ugy.workflow_lepesek && ugy.workflow_lepesek.hatáskor_vizsgalat ? ugy.workflow_lepesek.hatáskor_vizsgalat.datum : 'N/A' }}
                                </div>
                            </div>

                            <!-- Ellenőrzési lista -->
                            <div class="checklist-card">
                                <div class="card-header bg-light">
                                    <strong>Ellenőrzési lista</strong>
                                </div>
                                <div class="card-body p-0">
                                    <div v-for="(kriterium, index) in hatáskor_kriteriumok"
                                         :key="kriterium.id"
                                         class="checklist-item"
                                         :class="{ checked: kriterium.checked }">
                                        <div class="form-check">
                                            <input type="checkbox"
                                                   v-model="kriterium.checked"
                                                   :id="'hatáskor-' + kriterium.id"
                                                   class="form-check-input">
                                            <label :for="'hatáskor-' + kriterium.id" class="form-check-label">
                                                {{ kriterium.megnevezes }}
                                                <span v-if="kriterium.kotelezo" class="text-danger">*</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Megjegyzés -->
                            <div class="mt-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-chat-left-text"></i> Megjegyzés
                                </label>
                                <textarea class="form-control"
                                          v-model="hatáskor_megjegyzes"
                                          rows="3"
                                          placeholder="Hatáskör vizsgálathoz kapcsolódó megjegyzések..."></textarea>
                            </div>

                            <!-- Eredmény összegzés -->
                            <div v-if="ugy.ellenorzesek && ugy.ellenorzesek.hatáskor" class="mt-3 p-3 bg-light border-start border-4 border-success">
                                <strong>Döntés:</strong> {{ ugy.ellenorzesek.hatáskor.eredmeny === 'megfelel' ? 'Hatáskör biztosított' : '' }}
                                <div class="small text-muted mt-1">
                                    {{ ugy.ellenorzesek.hatáskor.megjegyzes }}
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Formai ellenőrzés -->
                        <div v-show="activeTab === 'formai'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1799</span>
                                    Formai megfelelőség vizsgálata
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0065</span>
                                    A kérelem formai követelményeknek való megfelelőségének ellenőrzése
                                </p>
                            </div>

                            <div class="alert alert-statusz alert-warning">
                                <strong>Státusz:</strong>
                                <span class="badge bg-warning text-dark ms-2">Folyamatban</span>
                                <div class="mt-2 small">
                                    <i class="bi bi-hourglass-split"></i>
                                    Ellenőrzés alatt - {{ ugy.workflow_lepesek && ugy.workflow_lepesek.formai_vizsgalat ? ugy.workflow_lepesek.formai_vizsgalat.datum_kezdes : 'N/A' }}
                                </div>
                            </div>

                            <!-- Ellenőrzési lista -->
                            <div class="checklist-card">
                                <div class="card-header bg-light">
                                    <strong>Ellenőrzési lista</strong>
                                </div>
                                <div class="card-body p-0">
                                    <div v-for="(kriterium, index) in formai_kriteriumok"
                                         :key="kriterium.id"
                                         class="checklist-item"
                                         :class="{ checked: kriterium.checked }">
                                        <div class="form-check">
                                            <input type="checkbox"
                                                   v-model="kriterium.checked"
                                                   :id="'formai-' + kriterium.id"
                                                   class="form-check-input">
                                            <label :for="'formai-' + kriterium.id" class="form-check-label">
                                                {{ kriterium.megnevezes }}
                                                <span v-if="kriterium.kotelezo" class="text-danger">*</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hiányosságok -->
                            <div class="mt-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-exclamation-triangle"></i> Észrevételek / Hiányosságok
                                </label>
                                <textarea class="form-control"
                                          v-model="formai_megjegyzes"
                                          rows="4"
                                          placeholder="Ha hiányosságot észlel, itt rögzítheti..."></textarea>
                            </div>
                        </div>

                        <!-- Tab: Tartalmi ellenőrzés -->
                        <div v-show="activeTab === 'tartalmi'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1794</span>
                                    Tartalmi megfelelőség vizsgálata
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0066</span>
                                    A kérelem tartalmi követelményeknek való megfelelőségének ellenőrzése
                                </p>
                            </div>

                            <div class="alert alert-statusz alert-secondary">
                                <strong>Státusz:</strong>
                                <span class="badge bg-secondary ms-2">Várakozik</span>
                                <div class="mt-2 small">
                                    <i class="bi bi-clock"></i>
                                    A formai ellenőrzés befejezése után indul
                                </div>
                            </div>

                            <!-- Ellenőrzési lista -->
                            <div class="checklist-card">
                                <div class="card-header bg-light">
                                    <strong>Ellenőrzési lista</strong>
                                </div>
                                <div class="card-body p-0">
                                    <div v-for="(kriterium, index) in tartalmi_kriteriumok"
                                         :key="kriterium.id"
                                         class="checklist-item"
                                         :class="{ checked: kriterium.checked }">
                                        <div class="form-check">
                                            <input type="checkbox"
                                                   v-model="kriterium.checked"
                                                   :id="'tartalmi-' + kriterium.id"
                                                   class="form-check-input">
                                            <label :for="'tartalmi-' + kriterium.id" class="form-check-label">
                                                {{ kriterium.megnevezes }}
                                                <span v-if="kriterium.kotelezo" class="text-danger">*</span>
                                                <span v-if="kriterium.F_kod" class="badge badge-function ms-2">{{ kriterium.F_kod }}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Megjegyzés -->
                            <div class="mt-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-chat-left-text"></i> Megjegyzés
                                </label>
                                <textarea class="form-control"
                                          v-model="tartalmi_megjegyzes"
                                          rows="3"
                                          placeholder="Tartalmi ellenőrzéshez kapcsolódó megjegyzések..."></textarea>
                            </div>
                        </div>

                        <!-- Tab: VNY024 Adatok -->
                        <div v-show="activeTab === 'vny024'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-function">F-0090</span>
                                    VNY024 Vasútegészségügyi adatok
                                </h5>
                                <p class="mb-0 small text-muted">
                                    Vasúti járművezetők egészségügyi nyilvántartási adatainak lekérdezése
                                </p>
                            </div>

                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i>
                                <strong>VNY024 nyilvántartás</strong>
                                <div class="small mt-1">
                                    Vasútegészségügyi alkalmasság nyilvántartási adatok központi rendszerből
                                </div>
                            </div>

                            <div v-if="ugy.vny024_adatok && ugy.vny024_adatok.van_adat" class="card">
                                <div class="card-header bg-light">
                                    <strong>Talált adatok</strong>
                                    <span class="badge bg-success float-end">Alkalmas</span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="small text-muted">Utolsó vizsgálat dátuma</label>
                                            <div class="fw-bold">{{ ugy.vny024_adatok.utolso_vizsgalat || 'N/A' }}</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="small text-muted">Alkalmassági minősítés</label>
                                            <div class="fw-bold text-success">{{ ugy.vny024_adatok.alkalmassag || 'N/A' }}</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="small text-muted">Érvényesség</label>
                                            <div class="fw-bold">{{ ugy.vny024_adatok.ervenyesseg || 'N/A' }}</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="small text-muted">Korlátozások</label>
                                            <div class="fw-bold">Nincs</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3">
                                <button class="btn btn-primary">
                                    <i class="bi bi-arrow-repeat"></i> Adatok újralekérdezése
                                </button>
                            </div>
                        </div>

                        <!-- Tab: Sommás eljárás döntés -->
                        <div v-show="activeTab === 'sommas'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1800</span>
                                    Sommás eljárás alkalmazhatóságának vizsgálata
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0088</span>
                                    Döntés-előkészítés: sommás vagy teljes eljárás
                                </p>
                            </div>

                            <div class="alert alert-info">
                                <h6><i class="bi bi-info-circle"></i> Sommás eljárás feltételei</h6>
                                <ul class="mb-0 small">
                                    <li>A kérelem minden szempontból megfelel</li>
                                    <li>Nincs szükség tényállás tisztázására</li>
                                    <li>Nincs szükség szakhatósági állásfoglalásra</li>
                                    <li>Határidő: 8 nap</li>
                                </ul>
                            </div>

                            <div class="card mt-3">
                                <div class="card-body">
                                    <h6>Döntési opciók:</h6>
                                    <div class="d-grid gap-2 mt-3">
                                        <button class="btn btn-success btn-lg text-start">
                                            <span class="badge bg-light text-dark me-2">UCE-1826</span>
                                            <strong>Sommás eljárás alkalmazása</strong>
                                            <div class="small mt-1">Határidő: 8 munkanap</div>
                                        </button>
                                        <button class="btn btn-primary btn-lg text-start">
                                            <span class="badge bg-light text-dark me-2">UCE-1826</span>
                                            <strong>Teljes eljárás lefolytatása</strong>
                                            <div class="small mt-1">Határidő: 60 nap</div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Döntési javaslat -->
                        <div v-show="activeTab === 'dontesi-javaslat'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1826</span>
                                    Döntési javaslat elkészítése
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0074</span>
                                    Érdemi döntés előkészítése
                                </p>
                            </div>

                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i>
                                Ez a lépés a vizsgálatok befejezése után aktiválódik
                            </div>

                            <div class="card">
                                <div class="card-header bg-light">
                                    <strong>Döntési javaslat sablon</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small text-muted">A döntési javaslat a következő elemeket tartalmazza:</p>
                                    <ul class="small">
                                        <li>Ügy azonosító adatai</li>
                                        <li>Vizsgálatok eredményeinek összefoglalása</li>
                                        <li>Jogszabályi hivatkozások</li>
                                        <li>Javasolt döntés indoklással</li>
                                        <li>Határidő számítás</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Dokumentum tervezetek -->
                        <div v-show="activeTab === 'dokumentumok'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1809/1810/1811</span>
                                    Dokumentum tervezetek
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0091</span>
                                    <span class="badge badge-function">F-0092</span>
                                    <span class="badge badge-function">F-0093</span>
                                    Végzés, Határozat, Igazolás tervezetek
                                </p>
                            </div>

                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="bi bi-file-earmark-text text-primary" style="font-size: 3rem;"></i>
                                            <h6 class="mt-3">Végzés tervezet</h6>
                                            <p class="small text-muted">
                                                <span class="badge badge-uce">UCE-1809</span>
                                                <span class="badge badge-function">F-0091</span>
                                            </p>
                                            <button class="btn btn-sm btn-outline-primary">Generálás</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="bi bi-file-earmark-check text-success" style="font-size: 3rem;"></i>
                                            <h6 class="mt-3">Határozat tervezet</h6>
                                            <p class="small text-muted">
                                                <span class="badge badge-uce">UCE-1810</span>
                                                <span class="badge badge-function">F-0092</span>
                                            </p>
                                            <button class="btn btn-sm btn-outline-success">Generálás</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body text-center">
                                            <i class="bi bi-file-earmark-medical text-info" style="font-size: 3rem;"></i>
                                            <h6 class="mt-3">Igazolás tervezet</h6>
                                            <p class="small text-muted">
                                                <span class="badge badge-uce">UCE-1811</span>
                                                <span class="badge badge-function">F-0093</span>
                                            </p>
                                            <button class="btn btn-sm btn-outline-info">Generálás</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Véleményeztetés -->
                        <div v-show="activeTab === 'velemenyezes'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1824</span>
                                    Döntési javaslat véleményeztetése
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0096</span>
                                    A döntési javaslat vezetői véleményezése
                                </p>
                            </div>

                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i>
                                A döntési javaslat elkészítése után kerül sor a véleményeztetésre
                            </div>
                        </div>

                        <!-- Tab: Ügy lezárása -->
                        <div v-show="activeTab === 'lezaras'" class="tab-pane fade-in">
                            <div class="tab-header">
                                <h5 class="mb-2">
                                    <span class="badge badge-uce">UCE-1828</span>
                                    Ügy lezárása
                                </h5>
                                <p class="mb-0 small text-muted">
                                    <span class="badge badge-function">F-0097</span>
                                    Az eljárás lezárása és archiválása
                                </p>
                            </div>

                            <div class="alert alert-secondary">
                                <i class="bi bi-lock"></i>
                                Az ügy lezárása a döntés kiadása és kézbesítése után lehetséges
                            </div>
                        </div>

                    </div>

                </div>

                <!-- ========================================
                     3. JOBB OSZLOP - Döntési és info panelek (3 col)
                     ======================================== -->
                <div class="col-md-3 bg-light p-0 sidebar-right"
                     :class="{
                         collapsed: rightCollapsed,
                         'border-start': !rightCollapsed
                     }"
                     :style="{
                         flex: rightCollapsed ? '0 0 50px' : '',
                         maxWidth: rightCollapsed ? '50px' : '',
                         width: rightCollapsed ? '50px' : ''
                     }">

                    <!-- Toggle gomb -->
                    <button class="toggle-btn toggle-btn-right" @click="rightCollapsed = !rightCollapsed">
                        <i class="bi" :class="rightCollapsed ? 'bi-chevron-left' : 'bi-chevron-right'"></i>
                    </button>

                    <!-- Normál nézet tartalma -->
                    <div class="sidebar-content">

                        <!-- PANEL 1: Döntési pontok (KÖTELEZŐ, ELSŐ) -->
                        <div class="border-bottom p-3 bg-white">
                            <h6 class="mb-3">
                                <i class="bi bi-check-circle text-success"></i> Döntési pontok
                                <span class="badge bg-dark ms-2">F-0088</span>
                            </h6>

                            <!-- Aktuális lépés szerint dinamikus gombok -->
                            <div v-if="activeTab === 'hatáskor'" class="d-grid gap-2">
                                <button class="decision-button btn btn-success" @click="dontHatáskor('hatáskor_van')">
                                    <span class="badge bg-light text-dark">UCE-1799</span>
                                    Hatáskör biztosított
                                </button>
                                <button class="decision-button btn btn-danger" @click="dontHatáskor('hatáskor_nincs')">
                                    <i class="bi bi-x-circle"></i>
                                    Áttétel másik hatósághoz
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'formai'" class="d-grid gap-2">
                                <button class="decision-button btn btn-success" @click="dontFormai('megfelel')">
                                    <span class="badge bg-light text-dark">UCE-1794</span>
                                    Megfelelő
                                </button>
                                <button class="decision-button btn btn-warning" @click="dontFormai('hianypotlas')">
                                    <span class="badge bg-light text-dark">F-0100</span>
                                    Hiánypótlás szükséges
                                </button>
                                <button class="decision-button btn btn-danger" @click="dontFormai('elutasitas')">
                                    <i class="bi bi-x-circle"></i>
                                    Elutasítás
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'tartalmi'" class="d-grid gap-2">
                                <button class="decision-button btn btn-success">
                                    <span class="badge bg-light text-dark">UCE-1800</span>
                                    Tartalmilag megfelelő
                                </button>
                                <button class="decision-button btn btn-warning">
                                    <span class="badge bg-light text-dark">F-0100</span>
                                    Hiánypótlás
                                </button>
                                <button class="decision-button btn btn-info">
                                    <span class="badge bg-light text-dark">F-0102</span>
                                    Tényállás tisztázás
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'sommas'" class="d-grid gap-2">
                                <button class="decision-button btn btn-success">
                                    <span class="badge bg-light text-dark">UCE-1826</span>
                                    Sommás eljárás
                                </button>
                                <button class="decision-button btn btn-primary">
                                    <span class="badge bg-light text-dark">UCE-1826</span>
                                    Teljes eljárás
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'dontesi-javaslat'" class="d-grid gap-2">
                                <h6 class="small text-muted mb-2">
                                    <span class="badge badge-function">F-0074</span>
                                    Döntési javaslat típusa
                                </h6>
                                <button class="decision-button btn btn-success" @click="dontesiJavaslatKeszit('engedelyezes')">
                                    <span class="badge bg-light text-dark">F-0091</span>
                                    Engedélyező végzés
                                </button>
                                <button class="decision-button btn btn-primary" @click="dontesiJavaslatKeszit('hatarozat')">
                                    <span class="badge bg-light text-dark">F-0092</span>
                                    Engedélyező határozat
                                </button>
                                <button class="decision-button btn btn-info" @click="dontesiJavaslatKeszit('igazolas')">
                                    <span class="badge bg-light text-dark">F-0093</span>
                                    Alkalmassági igazolás
                                </button>
                                <button class="decision-button btn btn-danger" @click="dontesiJavaslatKeszit('elutasitas')">
                                    <span class="badge bg-light text-dark">F-0092</span>
                                    Elutasító határozat
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'dokumentumok'" class="d-grid gap-2">
                                <h6 class="small text-muted mb-2">Dokumentum generálás</h6>
                                <button class="decision-button btn btn-outline-primary" @click="dokumentumGeneral('vegzes')">
                                    <span class="badge bg-primary">F-0091</span>
                                    Végzés tervezet
                                </button>
                                <button class="decision-button btn btn-outline-success" @click="dokumentumGeneral('hatarozat')">
                                    <span class="badge bg-success">F-0092</span>
                                    Határozat tervezet
                                </button>
                                <button class="decision-button btn btn-outline-info" @click="dokumentumGeneral('igazolas')">
                                    <span class="badge bg-info">F-0093</span>
                                    Igazolás tervezet
                                </button>
                                <button class="decision-button btn btn-outline-secondary" @click="dokumentumGeneral('tajekoztatas')">
                                    <span class="badge bg-secondary">F-0094</span>
                                    Tájékoztatás
                                </button>
                                <button class="decision-button btn btn-outline-dark" @click="dokumentumGeneral('hirdetmeny')">
                                    <span class="badge bg-dark">F-0095</span>
                                    Hirdetmény
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'velemenyezes'" class="d-grid gap-2">
                                <h6 class="small text-muted mb-2">
                                    <span class="badge badge-function">F-0096</span>
                                    Véleményezés típusa
                                </h6>
                                <button class="decision-button btn btn-primary" @click="velemenyezesIndit('vezeto')">
                                    <i class="bi bi-person-badge"></i>
                                    Vezető véleményezés
                                </button>
                                <button class="decision-button btn btn-info" @click="velemenyezesIndit('kollegialis')">
                                    <i class="bi bi-people"></i>
                                    Kollegiális véleményezés
                                </button>
                                <button class="decision-button btn btn-warning" @click="velemenyezesIndit('szakerto')">
                                    <i class="bi bi-mortarboard"></i>
                                    Szakértői vélemény
                                </button>
                            </div>

                            <div v-else-if="activeTab === 'lezaras'" class="d-grid gap-2">
                                <h6 class="small text-muted mb-2">
                                    <span class="badge badge-function">F-0097</span>
                                    Ügy lezárás típusa
                                </h6>
                                <button class="decision-button btn btn-success" @click="ugyLezar('engedelyezve')">
                                    <span class="badge bg-light text-dark">F-0098</span>
                                    Engedélyezve + FORRÁS
                                </button>
                                <button class="decision-button btn btn-danger" @click="ugyLezar('elutasitva')">
                                    <i class="bi bi-x-circle"></i>
                                    Elutasítva
                                </button>
                                <button class="decision-button btn btn-secondary" @click="ugyLezar('visszavont')">
                                    <i class="bi bi-arrow-counterclockwise"></i>
                                    Visszavont
                                </button>
                            </div>

                            <div v-else class="text-muted text-center py-3">
                                <i class="bi bi-info-circle"></i>
                                <div class="small mt-2">Válasszon workflow lépést</div>
                            </div>
                        </div>

                        <!-- PANEL 2: Eljárás előzmények (KÖTELEZŐ, MÁSODIK) -->
                        <div class="border-bottom p-3">
                            <h6 class="mb-3">
                                <i class="bi bi-clock-history text-primary"></i> Eljárás előzmények
                            </h6>
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-date">2024.10.17</div>
                                    <div class="timeline-content">
                                        <strong>Formai ellenőrzés megkezdve</strong><br>
                                        <span class="badge badge-uce">UCE-1799</span>
                                        <div class="small text-muted mt-1">Dr. Szabó Péter</div>
                                    </div>
                                </div>

                                <div class="timeline-item">
                                    <div class="timeline-date">2024.10.16</div>
                                    <div class="timeline-content">
                                        <strong>Hatáskör vizsgálat</strong><br>
                                        <span class="badge badge-uce">UCE-1793</span>
                                        <div class="small text-success mt-1">
                                            <i class="bi bi-check-circle"></i> Hatáskör biztosított
                                        </div>
                                    </div>
                                </div>

                                <div class="timeline-item">
                                    <div class="timeline-date">2024.10.15</div>
                                    <div class="timeline-content">
                                        <strong>Érkeztetés</strong><br>
                                        <span class="badge badge-uce">UCE-1778</span>
                                        <div class="small text-muted mt-1">EKEIDR iktatószám: 12345/2024</div>
                                    </div>
                                </div>

                                <div class="timeline-item">
                                    <div class="timeline-date">2024.10.15</div>
                                    <div class="timeline-content">
                                        <strong>Kérelem benyújtva</strong><br>
                                        <div class="small text-muted mt-1">Ügyfél: {{ ugy.ugyfel && ugy.ugyfel.nev ? ugy.ugyfel.nev : 'N/A' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PANEL 3: Kapcsolódó dokumentumok (KÖTELEZŐ, HARMADIK) -->
                        <div class="border-bottom p-3">
                            <h6 class="mb-3">
                                <i class="bi bi-file-text text-danger"></i> Kapcsolódó dokumentumok
                                <span class="badge bg-dark ms-2">F-0107</span>
                            </h6>
                            <div class="documents-list">
                                <div v-for="dok in dokumentumok"
                                     :key="dok.nev"
                                     class="document-item"
                                     @click="letoltDokumentum(dok)">
                                    <div class="d-flex align-items-center flex-grow-1">
                                        <i class="bi bi-file-pdf document-icon"></i>
                                        <div class="flex-grow-1">
                                            <div class="small">{{ dok.nev }}</div>
                                            <div class="text-muted" style="font-size: 0.7rem;">{{ dok.datum }}</div>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-link p-0">
                                        <i class="bi bi-download"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- PANEL 4: Ügyfél információk (OPCIONÁLIS) -->
                        <div class="p-3">
                            <h6 class="mb-3">
                                <i class="bi bi-person-circle text-info"></i> Ügyfél információk
                            </h6>
                            <div class="small">
                                <div class="mb-2">
                                    <strong>Név:</strong><br>
                                    {{ ugy.ugyfel && ugy.ugyfel.nev ? ugy.ugyfel.nev : 'N/A' }}
                                </div>
                                <div class="mb-2">
                                    <strong>Születési dátum:</strong><br>
                                    {{ ugy.ugyfel && ugy.ugyfel.szuletesi_datum ? ugy.ugyfel.szuletesi_datum : 'N/A' }}
                                </div>
                                <div class="mb-2">
                                    <strong>Lakcím:</strong><br>
                                    {{ ugy.ugyfel && ugy.ugyfel.lakcim ? ugy.ugyfel.lakcim : 'N/A' }}
                                </div>
                                <div class="mb-2">
                                    <strong>Telefon:</strong><br>
                                    <a v-if="ugy.ugyfel && ugy.ugyfel.telefon" :href="'tel:' + ugy.ugyfel.telefon">{{ ugy.ugyfel.telefon }}</a>
                                    <span v-else>N/A</span>
                                </div>
                                <div class="mb-2">
                                    <strong>E-mail:</strong><br>
                                    <a v-if="ugy.ugyfel && ugy.ugyfel.email" :href="'mailto:' + ugy.ugyfel.email">{{ ugy.ugyfel.email }}</a>
                                    <span v-else>N/A</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Kollapsz ikon sáv -->
                    <div class="collapsed-icon-bar bg-light">
                        <div class="text-center mb-3">
                            <i class="bi bi-check-circle-fill" style="font-size: 1.5rem; color: var(--vahap-success);"></i>
                        </div>
                        <div class="text-center mb-2">
                            <i class="bi bi-clock-history" title="Előzmények"></i>
                        </div>
                        <div class="text-center mb-2">
                            <i class="bi bi-file-text" title="Dokumentumok"></i>
                        </div>
                        <div class="text-center mb-2" v-if="ugy.dokumentumok && ugy.dokumentumok.length > 0">
                            <span class="badge bg-danger rounded-pill">{{ ugy.dokumentumok.length }}</span>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Mock Data -->
    <script src="../../assets/js/vihar-mock-data.js"></script>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // Kollapsz állapotok
                    leftCollapsed: false,
                    rightCollapsed: false,

                    // Aktuális ügy betöltése - alapértelmezett üres struktúra
                    ugy: {
                        ugyazonosito: '',
                        ugyfel: {},
                        ugyintezo: {},
                        workflow_lepesek: {},
                        ellenorzesek: {},
                        vny024_adatok: {},
                        dokumentumok: []
                    },
                    activeTab: 'formai', // Alapértelmezetten a folyamatban lévő lépés

                    // Ellenőrzési listák
                    hatáskor_kriteriumok: [],
                    formai_kriteriumok: [],
                    tartalmi_kriteriumok: [],

                    // Megjegyzések
                    hatáskor_megjegyzes: 'Hatáskör biztosított. A kérelem elbírálása a VHF hatáskörébe tartozik.',
                    formai_megjegyzes: '',
                    tartalmi_megjegyzes: '',

                    // Dokumentumok
                    dokumentumok: []
                }
            },

            mounted() {
                // URL paraméter lekérése
                const urlParams = new URLSearchParams(window.location.search);
                const ugyId = urlParams.get('ugy');

                if (ugyId) {
                    this.loadUgy(ugyId);
                } else {
                    this.loadUgy('VAHAP-V-2024-001234'); // Alapértelmezett
                }
            },

            methods: {
                loadUgy(ugyazonosito) {
                    // Load from VahapMockData.vasut.ugyek_belso
                    const ugyek = VahapMockData.vasut.ugyek_belso;
                    const foundUgy = ugyek.find(u => u.ugyazonosito === ugyazonosito);

                    if (!foundUgy) {
                        console.error('Ügy nem található:', ugyazonosito);
                        alert('Ügy nem található: ' + ugyazonosito);
                        return;
                    }

                    // Merge with default structure to ensure all properties exist
                    this.ugy = {
                        ...this.ugy,
                        ...foundUgy,
                        ugyfel: foundUgy.ugyfel || {},
                        ugyintezo: foundUgy.ugyintezo || {},
                        workflow_lepesek: foundUgy.workflow_lepesek || {},
                        ellenorzesek: foundUgy.ellenorzesek || {},
                        vny024_adatok: foundUgy.vny024_adatok || {},
                        dokumentumok: foundUgy.dokumentumok || []
                    };

                    // Load checklists
                    this.hatáskor_kriteriumok = VahapMockData.vasut.ellenorzesi_listak.hatáskor_illetekesseg.kriteriumok.map(k => ({
                        ...k,
                        checked: true // Már befejezett lépés
                    }));

                    this.formai_kriteriumok = VahapMockData.vasut.ellenorzesi_listak.formai_megfeleloseg.kriteriumok.map(k => ({
                        ...k,
                        checked: false // Folyamatban
                    }));

                    this.tartalmi_kriteriumok = VahapMockData.vasut.ellenorzesi_listak.tartalmi_megfeleloseg.kriteriumok.map(k => ({
                        ...k,
                        checked: false // Még nem kezdődött
                    }));

                    // Load dokumentumok
                    this.dokumentumok = this.ugy.dokumentumok || [];

                    console.log('[ÜgyMunkalap] Ügy betöltve:', this.ugy.ugyazonosito);
                },

                selectTab(tabName) {
                    this.activeTab = tabName;
                    console.log('[ÜgyMunkalap] Tab váltás:', tabName);
                },

                dontHatáskor(dontes) {
                    console.log('[F-0088] Hatáskör döntés:', dontes);

                    if (dontes === 'hatáskor_van') {
                        alert('Hatáskör biztosított.\nKövetkező lépés: Formai ellenőrzés (UCE-1799)');
                        this.selectTab('formai');
                    } else {
                        alert('Hatáskör hiányzik.\nÜgy áttétele másik hatósághoz.');
                    }
                },

                dontFormai(dontes) {
                    console.log('[F-0088] Formai döntés:', dontes);

                    if (dontes === 'megfelel') {
                        const osszesen = this.formai_kriteriumok.length;
                        const teljesitett = this.formai_kriteriumok.filter(k => k.checked).length;

                        if (teljesitett < osszesen) {
                            alert(`Figyelem!\nNem minden kritérium lett ellenőrizve (${teljesitett}/${osszesen})`);
                            return;
                        }

                        alert('Formai ellenőrzés megfelelő.\nKövetkező lépés: Tartalmi vizsgálat (UCE-1794)');
                        this.selectTab('tartalmi');
                    } else if (dontes === 'hianypotlas') {
                        alert('Hiánypótlási felszólítás készítése (F-0100)');
                    } else if (dontes === 'elutasitas') {
                        alert('Elutasító végzés készítése');
                    }
                },

                // F-0074 & F-0091-0095: Döntési javaslat és dokumentum tervezetek
                dontesiJavaslatKeszit(tipus) {
                    console.log('[F-0074] Döntési javaslat készítés:', tipus);

                    const sablonok = {
                        'engedelyezes': 'Engedélyező végzés tervezet (F-0091)\n\nAz ellenőrzések alapján javaslom a kérelem engedélyezését.',
                        'hatarozat': 'Engedélyező határozat tervezet (F-0092)\n\nA vasúti járművezető alkalmassági vizsgálat eredménye: ALKALMAS',
                        'igazolas': 'Alkalmassági igazolás tervezet (F-0093)\n\nIgazoljuk, hogy... alkalmassági követelményeknek megfelel.',
                        'elutasitas': 'Elutasító határozat tervezet (F-0092)\n\nA kérelem nem felel meg a jogszabályi követelményeknek.'
                    };

                    alert(`${sablonok[tipus]}\n\nF-0089: Ügyfél értesítés automatikusan elkészül.\nF-0096: Véleményezésre küldés lehetséges.`);

                    // Előzmények frissítése
                    this.selectTab('velemenyezes');
                },

                // F-0091-0095: Dokumentum generálás
                dokumentumGeneral(tipus) {
                    const dokumentumok = {
                        'vegzes': { funkció: 'F-0091', nev: 'Végzés tervezet', uce: 'UCE-1809' },
                        'hatarozat': { funkció: 'F-0092', nev: 'Határozat tervezet', uce: 'UCE-1810' },
                        'igazolas': { funkció: 'F-0093', nev: 'Igazolás tervezet', uce: 'UCE-1811' },
                        'tajekoztatas': { funkció: 'F-0094', nev: 'Tájékoztatás tervezet', uce: 'UCE-1812' },
                        'hirdetmeny': { funkció: 'F-0095', nev: 'Hirdetmény tervezet', uce: 'UCE-1813' }
                    };

                    const dok = dokumentumok[tipus];
                    console.log(`[${dok.funkció}] Dokumentum generálás:`, dok.nev);

                    alert(`${dok.nev} elkészítve!\n\n${dok.funkció} - ${dok.uce}\n\nA dokumentum tartalmazza:\n- Ügyazonosító\n- Hatósági döntés\n- Jogszabályi hivatkozások\n- Indokolás\n- Jogorvoslati lehetőség`);

                    // Dokumentum hozzáadása a listához
                    this.ugy.dokumentumok.push({
                        nev: dok.nev,
                        tipus: 'pdf',
                        datum: new Date().toISOString().split('T')[0],
                        funkció: dok.funkció
                    });
                },

                // F-0096: Véleményeztetés
                velemenyezesIndit(tipus) {
                    console.log('[F-0096] Véleményezés indítás:', tipus);

                    const velemenyezok = {
                        'vezeto': 'Osztályvezető jóváhagyása szükséges',
                        'kollegialis': 'Kollegiális véleményezés - 3 ügyintéző bevonása',
                        'szakerto': 'Külső szakértő véleménye szükséges'
                    };

                    alert(`F-0096 - Rugalmas workflow\n\n${velemenyezok[tipus]}\n\nUCE-1824: Döntési javaslat véleményeztetése\n\nA véleményezés határideje: 5 munkanap`);
                },

                // F-0097 & F-0098: Ügy lezárás
                ugyLezar(tipus) {
                    console.log('[F-0097] Ügy lezárás:', tipus);

                    if (tipus === 'engedelyezve') {
                        alert('F-0097: Ügy lezárása - Engedélyezve\nF-0098: FORRÁS SQL interfész\n\nAz engedély adatai átkerülnek a FORRÁS nyilvántartásba.\nUCE-1828: Ügy lezárása végrehajtva.\n\nF-0099: Vezetői döntés jóváhagyva.');
                    } else if (tipus === 'elutasitva') {
                        alert('F-0097: Ügy lezárása - Elutasítva\n\nElutasító határozat kiadmányozva.\nÜgyfél értesítése (F-0089) megtörtént.\nJogorvoslati lehetőség tájékoztatás elküldve.');
                    } else {
                        alert('F-0097: Ügy lezárása - Visszavont\n\nÜgyfél visszavonta kérelmét.\nÜgy lezárva adminisztratív úton.');
                    }

                    // Workflow lépés frissítése
                    if (this.ugy.workflow_lepesek) {
                        this.ugy.workflow_lepesek.ugy_lezaras = {
                            uce: 'UCE-1828',
                            allapot: 'kész',
                            datum: new Date().toISOString().split('T')[0],
                            tipus: tipus
                        };
                    }
                },

                letoltDokumentum(dok) {
                    console.log('[F-0107] Dokumentum letöltés:', dok.nev);
                    alert('Dokumentum letöltése:\n' + dok.nev + '\n\n(Mock rendszer - valós letöltés nincs)');
                },

                formatDate(dateString) {
                    if (!dateString) return '';
                    const parts = dateString.split('-');
                    return `${parts[0]}.${parts[1]}.${parts[2]}.`;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
